#!/usr/bin/env perl
# takes -s <module::name> and returns 21 distribution-names that match pattern
# use it before build to find exact dist-name 

use Term::ANSIColor;
use HTTP::Tiny;
use JSON::PP;
use Getopt::Std;

die "Usage:\n\n\ mcpq -s <Module::Name>\n\n" unless @ARGV;

getopts('s:', \%opts);

my $pm_req='https://metacpan.org/search/autocomplete?q='."$opts{s}";
my $meta_json = HTTP::Tiny->new->get("$pm_req");
die "https request failed!\n" unless $meta_json->{success};

_parse($meta_json->{content}) if length $meta_json->{content};

sub _parse {
    my $j = shift;
    my $pm = decode_json $j;
    my $i==1;

    for my $dist (@$pm) {
        if ($i % 2) {
            print colored(qq!$$dist{'distribution'}!, q!white on_black!);
        } else {
            print colored(qq!$$dist{'distribution'}!, q!bright_white on_black!);
        }
        print colored(qq!\ \:\:\ !, q!red on_black!);
        $i++;
    }
    print "\n";
}
